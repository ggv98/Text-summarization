 ВЪВЕДЕНИЕ Опцията е договор между две страни, при която едната страна е задължена, при желание на другата страна, да й продаде или купи определен брой акции по предварително договорена цена и преди изтичането на определен срок. Страната, която продава опцията се нарича  продавач  или  подписник  на  опцията.  Страната,  която  купува  опцията  се  нарича купувач или притежател на опцията. В зависимост от това, за какво се отнася опцията за покупка или продажба на акции опциите биват два вида: Кол опция  - тя дава право на притежателя да закупи определен брой акции по фиксираната в опционния договор цена на притежателя  си  и  преди  изтичане  на  договорения  срок;  Пут  опция  –  тя  дава  право  на притежателя си да продаде определен брой акции по фиксираната в опционния договор цена и преди изтичане на договорения срок. В зависимост от това кога може да се упражни опцията се разглеждат два вида опции: Европейска – опцията може да се упражни само на фиксираната дата Т; Американска – тя може да се упражни във всеки момент от периода между издаването на опцията и дататта на падежа Т. Методите  на  крайните  разлики  се  използват  толкова  широко,  защото  притежават редица положителни свойства. Например те позволяват много добре да се определи реда на грешката и нивото на точност на алгоритъма, докато при други методи не е така. Още, те са удобни  за  пресмятане  на  диференциални  уравнения  със  сравнително  сложни  начални  и терминални условия [3].  Ние разглеждаме линеен модел на Блек–Шолс за оценка на кол и пут опция 𝜕𝑉 1 𝜕2𝑉 𝑑𝑉+ 𝜎2𝑆2 +𝑟𝑆 −𝑟𝑉 = 0 𝜕𝑡 2 𝜕𝑆2 𝑑𝑆                                                 7 Докладът е представен на студентската научна сесия на 23. 05. 2018 г. в секция „Финансова математика“ с оригинално заглавие на български език: ТОЧНИ И ЧИСЛЕНИ РЕШЕНИЯ ЗА БЛЕК–ШОЛС ЕВРОПЕЙСКИ ОПЦИИ   - 47 - PROCEEDINGS OF UNIVERSITY OF RUSE - 2018, volume 57, book 6.5. с крайна цена, съответно за кол и пут опции 𝐶(𝑆,𝑇) = (𝑆−𝐾)+(кол) = max(𝑆−𝐾,0), 𝑃(𝑆,𝑇) = (𝐾 −𝑆)+(пут).  Гранични условия най – често са следните: 𝐶(0,𝑡) = 0,𝐶(𝑆,𝑡) = 𝑆−𝐸𝑒𝑟(𝑇−𝑡) при 𝑆 → +∞ (кол), 𝑃(0,𝑡) = 𝐸𝑒−𝑟(𝑇−𝑡),𝑃(𝑆,𝑡) = 0 при 𝑆 → +∞ (пут). Да положим 𝑆 1 1 2𝑥 = ln( ),𝜏∶= 𝜎2(𝑇−𝑡),𝑦(𝑥,𝜏) = 𝑉(𝐾𝑒2,𝑇− ), 𝐾 2 2 𝜎2𝜏или   𝑘−1 (𝑘+1)2𝑉(𝑥,𝜏) = 𝑒− 2 𝑥− 4 𝜏𝑦(𝑥,𝜏), и така намираме, че у удовлетворява уравнението на топлопроводността 𝜕𝑦 𝜕2𝑦= ,𝜏 ∈ [0,𝑇],𝑥 ∈[𝑥 ,𝑥 ]. 𝜕𝜏 𝜕𝑥2 𝑚𝑖𝑛 𝑚𝑎𝑥 От тук, връщайки се към оригиналните променливи, например за кол опцията имаме: 𝐶(𝑆,𝑡) = 𝑆𝑁(𝑑 )−𝐾𝑒−𝑟(𝑇−𝑡)𝑁(𝑑 ) + −където  N(z) e стандартното разпределение 𝑁(𝑧) = √12𝜋∫−𝑥∞𝑒−12𝑦2𝑑𝑦,   𝑑± = ((√𝑥2𝜋+12)𝑘 ±1)√2𝜏.  ДИФЕРЕНЧНИ АПРОКСИМАЦИИ Диференчната апроксимация на стойността на производната на функцията 𝑓(𝑥)в точка 𝑥 , например 𝑓′(𝑥 ) е някаква комбинация от стойностите на функцията в точки, близки до 𝑥 . 0 0 0Например, ако за някакво малко ℎ > 0 развием 𝑓(𝑥+ℎ) в ред на Тейлър, разделим на ℎ и групираме членовете от двете страни на равенството получаваме 𝑓(𝑥+ℎ)−𝑓(𝑥) ℎ𝑓′(𝑥)= + 𝑓′′(𝜉) ℎ 2за 𝜉 ∈ (𝑥,𝑥+ℎ) и тогава 𝑓(𝑥+ℎ)−𝑓(𝑥)𝑓′(𝑥)≈ . ℎТъй като 𝑓′′(𝜉) е число, то разликата между 𝑓′(𝑥) и диференчното частно е израз на ℎ1, т. е. грешката, която допускаме, е от първи ред. Това означава, че ако 10 пъти намалим ℎ, то ще получим 10 пъти по-точно приближение [2]. Диференчната разлика, която разгледахме, се нарича права или дясна разлика.Ако вземем под внимание точките 𝑥−ℎи 𝑥 вместо по-горе разгледаните, ще получим следната апроксимация: 𝑓(𝑥)−𝑓(𝑥−ℎ)𝑓′(𝑥)≈ , ℎкоято се нарича обратна или лява разлика. Тук грешката също е от първи ред. Ако поискаме да намалим грешката, трябва да разгледаме повече на брой точки около 𝑥.   Нека  вземем трите точки 𝑥−ℎ, 𝑥и 𝑥+ℎ. След като развием в ред на Тейлър стойностите 𝑓(𝑥−ℎ) и 𝑓(𝑥+ℎ), вадим първия израз от втория и записваме   - 48 - PROCEEDINGS OF UNIVERSITY OF RUSE - 2018, volume 57, book 6.5. 𝑓(𝑥+ℎ)−𝑓(𝑥−ℎ)𝑓′(𝑥)≈ , 2ℎкъдето грешката е от втори ред, т. е. ако намалим 10 пъти ℎ, грешката ще намалее от порядъка на 100 пъти. Това представлява централна разлика.   Фигура 1. Сравнение на права разлика (отляво) и централна разлика (отдясно)  при апроксимация на първа производна.    Преимуществото на по-високия ред грешка се забелязва нагледно (фигура 1).За по-висок  ред  производни  също  трябва  да  изберем  повече  на  брой  точки.  След  подобни преобразувания получаваме централната разлика за втората производна: 𝑓′′(𝑥)≈ 𝑓(𝑥+ℎ)−2𝑓(𝑥)+𝑓(𝑥−ℎ),  (1) ℎ2където грешката също е от втори ред.  ДИФЕРЕНЧНИ СХЕМИ   Нека  разгледаме  топлинното  диференциално  уравнение  с  една  пространствена променлива 𝜕𝑦 𝜕2𝑦= ,𝜏 ∈ [0,𝑇],𝑥 ∈[𝑥 ,𝑥 ], 𝜕𝜏 𝜕𝑥2 𝑚𝑖𝑛 𝑚𝑎𝑥със следните гранични условия: 𝑦(𝑥,0) = 𝑦 (𝑥),𝑦(𝑥 ,𝜏) = 𝑦 (𝜏),𝑦(𝑦 ,𝜏) = 𝑦 (𝜏). 0 𝑚𝑖𝑛 𝑙 𝑚𝑎𝑥 𝑟  Това параболично диференциално уравнение заема важно място дори във финансовата математика, тъй като уравнението на Блек и Шолс може да се сведе до топлинното само с няколко полагания.   Въпреки, че уравнение (1) има аналитично решение, ние ще разгледаме численото решаване посредством метода на Кранк – Никълсън, като за сравнение ще маркираме и другите известни диференчни схеми.   Нека дискретизираме областта [𝑥 ,𝑥 ] на 𝑁 равни интервала 𝑚𝑖𝑛 𝑚𝑎𝑥𝑥 = 𝑥 +𝑖ℎ за 𝑖 =0,1,…,𝑁, 𝑖 𝑚𝑖𝑛𝑥 −𝑥ℎ = 𝑚𝑎𝑥 𝑚𝑖𝑛 𝑁𝑇и нека 𝜏 = ∆𝜏.𝑗за 𝑗 = 0,1,…,𝑀, ∆𝜏 = . 𝑗𝑀Нека приближим и 𝑦(𝑥 ,𝜏 ) ≅ 𝑌 . 𝑖 𝑗 𝑖𝑗 ЯВНА ДИФЕРЕНЧНА СХЕМА При явната схема използваме правата разлика за производната по време и втората централна  разлика  за  втората  производна  по  пространство.  След  като  приложим  вече показаните формули получаваме   - 49 - PROCEEDINGS OF UNIVERSITY OF RUSE - 2018, volume 57, book 6.5. 𝑌 −𝑌 𝑌 −2𝑌 +𝑌𝑖𝑗+1 𝑖𝑗 𝑖−1𝑗 𝑖𝑗 𝑖+1𝑗− = 0 ∆𝜏 ℎ2∆𝜏и ако означим 𝜌 = , се получава ℎ2𝑌 = 𝜌𝑌 +(1−2𝜌)𝑌 +𝜌𝑌𝑖𝑗+1 𝑖−1𝑗 𝑖𝑗 𝑖+1𝑗{ 𝑌 = 𝑌(𝜏 )  0𝑗 𝑙 𝑗𝑌 =𝑌 (𝜏 )𝑁𝑗 𝑟 𝑗         Фигура 2. Явна диференчна схема.    Структурата на възлите от мрежата, които участват в една итерация се виждат на фигура 2.Числената грешка е първи ред по време и втори по пространство:  ∆𝑦 = 𝑂(∆𝜏)+𝑂(ℎ2).    Предимствата на явната схема са, че тя е проста и лесна за разбиране и имплементация, както и че може да се реализира итеративно, без да е нужно изчисленията за всеки времеви слой да се правят едновременно. Това води и до намалена изчислителна сложност.   Основният ѝ недостатък обаче е много значим – тя не е безусловно устойчива. За да 1бъде устойчива, достатъчно условие е да е изпълнено 𝜌 ≤ . 2  В практката явните схеми не са често използвани.  НЕЯВНА ДИФЕРЕНЧНА СХЕМА При неявната диференчна схема се използва обратната разлика за производната по време и отново втората централна разлика за производната по пространство. Схемата изглежда така: 𝑌 −𝑌 𝑌 −2𝑌 +𝑌𝑖𝑗+1 𝑖𝑗 𝑖−1𝑗+1 𝑖𝑗+1 𝑖+1𝑗+1− = 0 ∆𝜏 ℎ2 𝑌 = −𝜌𝑌 +(1+2𝜌)𝑌 −𝜌𝑌𝑖𝑗 𝑖−1𝑗+1 𝑖𝑗+1 𝑖+1𝑗+1{ 𝑌 = 𝑌(𝜏 )  0𝑗+1 𝑙 𝑗+1𝑌 =𝑌 (𝜏 )𝑁𝑗+1 𝑟 𝑗+1          Фигура 3. Неявна схема      - 50 - PROCEEDINGS OF UNIVERSITY OF RUSE - 2018, volume 57, book 6.5. Редът на грешката е същият като при явната схема: ∆𝑦 = 𝑂(∆𝜏)+𝑂(ℎ2). Предимството ѝ пред явната схема е голямо – неявната схема е безусловно устойчива. Това,  обаче,  от  своя  страна  води  до  повишена  изчислителна  сложност  и  съответно невъзможността изчисленията по един времеви слой да се правят последователно.Затова при всеки времеви слой се решава матрично уравнение. Матрицата, с която се работи, е с голям размер, но тъй като тя е тридиагонална, съществуват бързи методи за обръщането ѝ.  ЯВНО–НЕЯВНА СХЕМА НА КРАНК–НИКЪЛСЪН  При схемата на Кранк – Никълсън се използват централни разлики и по време, и по пространство. Това е една от основните разлики с предишните схеми. По този начин се засяга точката 𝑌 , която не е част от мрежата. Получава се 1𝑖𝑗+2𝑌 −𝑌 1 𝑌 −2𝑌 +𝑌 𝑌 −2𝑌 +𝑌𝑖𝑗+1 𝑖𝑗 𝑖−1𝑗+1 𝑖𝑗+1 𝑖+1𝑗+1 𝑖−1𝑗 𝑖𝑗 𝑖+1𝑗− ( + )= 0 ∆𝜏 2 ℎ2 ℎ2и съответно 2(1+𝜌)𝑌 −2(1−𝜌)𝑌 = 𝜌(𝑌 +𝑌 +𝑌 +𝑌 )𝑖𝑗+1 𝑖𝑗 𝑖−1𝑗+1 𝑖+1𝑗+1 𝑖−1𝑗 𝑖+1𝑗{ 𝑌 = 𝑌(𝜏 ),𝑌 = 𝑌(𝜏 )  0𝑗 𝑙 𝑗 0𝑗+1 𝑙 𝑗+1𝑌 = 𝑌 (𝜏 ),𝑌 = 𝑌 (𝜏 )𝑁𝑗 𝑟 𝑗 𝑁𝑗+1 𝑟 𝑗+1           Фигура 4.Схема на Кранк-Никълсън  Поради централната разлика по време, при схемата наКранк – Никълсън грешката е от втори ред и по двете измерения: ∆𝑦 = 𝑂(∆𝜏2)+𝑂(ℎ2). Схемата  на  Кранк  –  Никълсън  е  условно  устойчива.  Тогава  защо  се  е  наложило разработването ѝ? Тъй като редът на грешките и по двете променливи е еднакъв, то е разумно и двете стъпки да са от еднакъв порядък – т. е. ∆𝜏 ≈ ℎ. Именно това дава голямото предимство на схемата на Кранк – Никълсън: методът е по-бързо сходящ и може да се постигне идентична точност спрямо другите методи с по-малък брой времеви стъпки. Един недостатък на схемата е, че не се справя толкова добре с осцилациите, които се наблюдават около прекъсвания или ъгли при функцията на решението. Затова е добра идея първо да се използва чисто неявна схема, докато негладкостите изчезнат, и след това да се превключи към схемата на Кранк – Никълсън с по-голяма времева стъпка.  РЕАЛИЗАЦИЯ НА СХЕМАТА НА КРАНК – НИКЪЛСЪН Диференчното уравнение може да се запише в матричен вид: 𝐴𝑌 = 𝐵𝑌 +𝜌(𝑐 +𝑐 ), 𝑗+1 𝑗 𝑗+1 𝑗където   - 51 - PROCEEDINGS OF UNIVERSITY OF RUSE - 2018, volume 57, book 6.5. 2(1+𝜌) −𝜌 0 ⋯ 0 0   −𝜌 2(1+𝜌) −𝜌 ⋯ 0 0   𝐴 = 0 −𝜌 2(1+𝜌) ⋯ 0 0 ,      ⋮ ⋮ ⋮ ⋱ ⋮ ⋮  [ 0 0 0 ⋯ −𝜌 2(1+𝜌)] 2(1−𝜌) 𝜌 0 ⋯ 0 0   𝜌 2(1−𝜌) 𝜌 ⋯ 0 0   𝐵 = 0 𝜌 2(1−𝜌) ⋯ 0 0 ,      ⋮ ⋮ ⋮ ⋱ ⋮ ⋮  [ 0 0 0 ⋯ 𝜌 2(1−𝜌)]𝑇 𝑇𝑌 =(𝑌 ,𝑌 ,…,𝑌 ) ,𝑐 = (𝑌 = 𝑌(𝜏 ),0,…,0,𝑌 = 𝑌 (𝜏 )) . 𝑗 1𝑗 2𝑗 𝑁−1𝑗 𝑗 0𝑗 𝑙 𝑗 𝑁𝑗 𝑟 𝑗Очевидно решението се дава с 𝑌 = 𝐴−1(𝐵𝑌 +𝜌(𝑐 +𝑐 )). 𝑗+1 𝑗 𝑗+1 𝑗Собствените стойности на 𝐴−1𝐵 са 𝑘𝜋2−4sin2( )2𝑁𝛼 = ,𝑘 = 1,2,…,𝑁−1. 𝑘 𝑘𝜋2+4sin2( )2𝑁Тъй като |𝛼 |≤ 1за всяко 𝑘, решение винаги съществува и схемата е условно устойчива. 𝑘Най-тежката  операция  в  решаването  на  уравнението  е  намирането  на  обратната матрица на 𝐴. Въпреки, че може да се използва директно метод на Якоби, метод на Гаус – Зайдел или свръхгорна релаксация, най-добре е да се възползваме от факта, че матрицата е тридиагонална. Например може да използваме метода на прогонката.  ЧИСЛЕН ЕКСПИРИМЕНТ   Още  от  1977  г.  крайните  диференчни  схеми  се  използват  активно  в  областта  на финансовата математика.  Досега разгледахме метода на Кранк – Никълсън, приложен върху топлинното уравнение, което от своя страна лесно се свежда до уравнението на Блек и Шолс. Обаче, последното отново е параболично диференциално уравнение и може направо към него да се подходи с крайна диференчнасхема.Основният момент е да се „обърне“времето, така че матуритетът на опцията да е в 𝜏 = 0, а настоящият момент𝜏 = 𝑇.Такава програмна реализация е представена във файла на МАТЛАБ.  >>help optionCN Function to calculate the price of a vanilla European   Put and Call option using the Crank-Nicolson finite difference method  oPrice = optionCN(K,S0,r,sig,Smax,h)    Inputs: K - strike         : S0 - stock price         : r - risk free interest rate         : sig - volatility         : Smax - maximal stock price (end spatial point)         : h - size of the spatial step    Output: oPrice - the call and put option price    - 52 - PROCEEDINGS OF UNIVERSITY OF RUSE - 2018, volume 57, book 6.5.   ЗАКЛЮЧЕНИЕ Настоящият доклад представя: Трансформация която превежда уравнението на Блек – Шолс описващо цени на опции до топлинното уравнение. За последното са построени много числени методи. Важна стъпка от решението на една задача е правилният подбор на метод, който ще бъде използван. След направения анализ имаме възможността да сравним полезността на всеки един от методите спрямо даден проблем.    