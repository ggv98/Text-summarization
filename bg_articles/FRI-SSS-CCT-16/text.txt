 ВЪВЕДЕНИЕ Една от задачите, която е необходимо да се решава при разпределените системи е синхронизацията на системните часовници на отделните съставящи процеси (Lukanchevski, M., 2014, Coulouris, G., Dollimore, J., Kindberg, T., & Blair, G., 2011). Различават се вътрешна и външна синхронизация. При вътрешната синхронизация системните процеси P , P , …, P  0 1 n-1синхронизират  помежду  си  показанията  на  часовниците  си.  Докато  при  външната синхронизация показанието C(t) на часовника на процеса P се синхронизира с показанието i iS(t) на външен времеви еталон. Един от стандартизираните в Интернет протоколи за външна синхронизация е Time Protocol, описан в RFC-868. Протоколът представлява разновидност на модела клиент-сървър. Взаимодействието между клиента и сървъра се описва с комуникационната диаграма от фиг. 1. Времевият сървър S прослушва TCP порт 37. Синхронизацията се инициира от клиента C чрез изграждането на TCP връзка с порт 37 на сървъра. Това се възприема от сървъра като заявка, на която той отговаря с 4-байтово двоично съобщение. След получаването на отговора клиентът затваря връзката. На комуникационната диаграма са обозначени и събитията на сокетите, обслужвани от съответната страна. В (Penkov, E., 2018) са предложени две реализации на Time Protocol (RFC-868) сървър: класическа  еднозадачна  (последователна)  с  опашка  на  чакащите  заявки  и  многозадачна (паралелна). Многозадачната е изпълнена в два алтернативни варианта - с библиотечния клас VCL::TThread и класа std::thread от стандартната библиотека C++11. В експерименталната част на посочената работа е констатирано: „Определен интерес представлява поведението на многозадачната реализация на сървъра при голям брой множествени заявки – от няколко десетки до няколко хиляди. От една страна, така може да се получи по-точна оценка за                                                  27 Докладът е представен на студентската научна сесия на 27.04.2018 г. в секция „Комуникационна и компютърна техника“ с оригинално заглавие на български език: ИЗТОЧНИК НА РАБОТЕН ТОВАР НА TIME PROTOCOL (RFC-868) СЪРВЪР.   - 139 - PROCEEDINGS OF UNIVERSITY OF RUSE - 2018, volume 57, book 3.4. времевите характеристики на сървъра. От друга страна, може да се оцени максималният брой едновременни заявки, които сървърът може да поеме, както и влиянието на този брой върху реактивността на сървъра.“ Така се прави извода за необходимостта от специализиран източник на работен товар, където този товар включва пакет от заявки към Time Protocol сървъра. В представения доклад се разглеждат някои моменти от текущата разработка на подобен източник на множествени заявки (TSLS, Time Server Load Source).   Фиг. 1. Комуникационна диаграма на протокола при TCP сокети  ИЗЛОЖЕНИЕ Етапи на работа Сложността на работата предполага разбиването ѝ на няколко етапа (фиг. 2). При разработката на алфа прототипа се тръгва от фиксиран адрес на времевия сървър, фиксиран пакет от 4 заявки и последователна (еднозадачна) обработка в събитията на сокетите (версия 0.1.0.x.TSLS). А в края на този етап се достига до възможност за преконфигуриране на параметрите  и  паралелна  (многозадачна)  обработка  в  събитието  OnRead  на  клиентските сокети (версия 0.3.0.x.TSLS). При приключването на бета прототипа (версия 1.2.3.x.TSLS) се отчитат не само двете крайни състояния на връзката по TCP сокетите (Close, Open), но и преходното състояние (Transient, Half-Open); въведен е параметър Consecutive, с който се задава последователно отваряне  на  сокет  връзките;  точността  на  извеждане  на  времето  е  разширена  до  1  ms; допълнително  е  намалена  инструменталната  грешка  чрез  изнасяне  на  визуализацията  на системния протокол след приключването на синхронизацията. На  етапа  на  пусковия  прототип  (версия  2.1.0.x.TSLS)  се  осигурява  фиксиране  на характеристичните времена при тестовете под товар, с оглед последващата обработка с Excel. Развит е .XLTX шаблон за фиксиране и първична обработка на експерименталните резултати. Последователното включване на необходимите базови средства (Josuttis, N., 2012) за осигуряване на посочената функционалност схематично е представена на фиг. 2.  Метрики, характеристични времена, вътрешна организация Ключовите  метрики  при  TCP  сървърите  са:  времето  за  установяване  на  връзка (Connection Setup Time), времето за отговор на сървъра (Server Response Time), интервала от изпращане на заявката до получаване на отговора (Network Round-Trip Time) и др. (Shanahan, Dan, 2015).   - 140 - PROCEEDINGS OF UNIVERSITY OF RUSE - 2018, volume 57, book 3.4.  Фиг. 2. Етапност на реализацията  Обслужването на заявките от времевия сървър се описва с характеристичните времена от фиг. 3, които са директно следствие от комуникационния протокол (фиг. 1) и особеностите на TCP сокетите.    Фиг. 3. Характеристични времена Докато на фиг. 3 са приведени характеристичните времена за отделно взет клиент, на фиг. 4 е представена цялостната времедиаграма при пакет множествени заявки. За получаване на посочените ключови метрики за всеки един клиент  𝐶  от пакета е необходимо да се 𝑖фиксират моментите на формиране на заявка за синхронизация 𝑡𝑖 , на получаване на тази 𝑅𝐸𝑄  - 141 - PROCEEDINGS OF UNIVERSITY OF RUSE - 2018, volume 57, book 3.4. заявка от сървъра 𝑡𝑖 , на получаването на отговора от сървъра в клиента 𝑡𝑖  и на разпадане 𝐶𝑁𝐶 𝑅𝑃𝐿на връзката със сървъра 𝑡𝑖 . 𝐷𝑆𝐶Началният  момент  на  синхронизация  𝑡   съвпада  със  стартирането  на  пакета 𝑆𝑌𝑁множествени заявки, а крайният - 𝑡  отговаря на момента на разпадане на последната връзка 𝐸𝑁𝐷от пакета. Това не е задължително 𝑡𝑛−1, поради непредсказуемия асинхронен и конкурентен 𝐷𝑆𝐶начин на установяване на връзките и обработката, т.е. 𝑡 = m𝑎𝑥⁡(𝑡𝑖 ,𝑡𝑖 ). 𝐸𝑁𝐷 𝐷𝑆𝐶 𝐸𝑅𝑅На фигурите не е посочен друг характерен момент – 𝑡𝑖  при отказ от страна на сървъра 𝐸𝑅𝑅да установи връзка с клиента 𝐶 . Моментите на подобно отхвърляне на заявките, както и броя 𝑖на  тези  отхвърляния  -  n   също  са  част  от  метриките  на  сървъра  и  характеризират ERRспособността му да обслужва едновременно голям брой заявки.   Фиг. 4. Характеристична времедиаграма  Двойките характеристични времена формират съответните характеристични периоди, от които се изчисляват метриките на производителността на сървъра: -  периодът  [𝑡 ,𝑡 ]  с  абсолютна  стойност  𝑡 −𝑡   отговаря  на  времето  за 𝑅𝐸𝑄 𝐶𝑁𝐶 𝐶𝑁𝐶 𝑅𝐸𝑄установяване на връзка, а при конкретния протокол и на времето за изпращане на заявка; -  периодът  [𝑡 ,𝑡 ]  с  абсолютна  стойност  𝑡 −𝑡   отговаря  на  времето  за 𝐶𝑁𝐶 𝑅𝑃𝐿 𝑅𝑃𝐿 𝐶𝑁𝐶отговор на сървъра;   -  периодът [𝑡 ,𝑡 ] с абсолютна стойност 𝑡 −𝑡  отговаря на интервала от 𝑅𝐸𝑄 𝑅𝑃𝐿 𝑅𝑃𝐿 𝑅𝐸𝑄изпращане на заявката до получаване на отговора; -  периодът [𝑡 ,𝑡 ] с абсолютна стойност 𝑡 −𝑡  отговаря на общото време на 𝑆𝑌𝑁 𝐸𝑁𝐷 𝐸𝑁𝐷 𝑆𝑌𝑁обслужване; производителността на сървъра 𝑃 = 𝑛−𝑛𝐸𝑅𝑅  е отношението на реалния 𝑡𝐸𝑁𝐷−𝑡𝑆𝑌𝑁брой обслужени заявки 𝑛−𝑛  и общото време на обслужване. 𝐸𝑅𝑅Предложената структура на източника на множествени заявки TSLS е представена на фиг. 5. Въвежда се ново пространство на имената tsp, съдържащо декларациите на класовете tsp::Parameters, tsp::Client, tsp::ClientsPack и tsp::log.  Обект от класа tsp::Parameters съдържа конфигурационните параметри. Те се четат от конфигурационния .INI файл.   - 142 - PROCEEDINGS OF UNIVERSITY OF RUSE - 2018, volume 57, book 3.4. Класът tsp::ClientsPack включва вектора vClients, характеристичните времена 𝑡 , 𝑡 , 𝑆𝑌𝑁 0𝑡  и копие на конфигурационните параметри. Векторът vClients съдържа клиентите от 𝐸𝑁𝐷пакета. Клиентите са от  клас  tsp::Client. Каналът  csOut на всеки такъв клиент е от тип VCL::TClientSocket и служи за връзка с избрания времеви сървър TS. Клиентите фиксират индивидуалните си характеристични времена 𝑡𝑖 , 𝑡𝑖 , 𝑡𝑖 , 𝑡𝑖  и 𝑡𝑖 , заедно с общия брой 𝑅𝐸𝑄 𝐶𝑁𝐶 𝑅𝑃𝐿 𝐷𝑆𝐶 𝐸𝑅𝑅на обслужваните в съответния момент клиенти. За минимизиране на внасяната инструментална грешка не се поддържа протокол на екрана по време на измерванията, а се използва обект от специализирания клас tsp::log в паметта. Едва след приключването на измерванията съдържанието на този обект се извежда на екрана и фиксира в .CSV файл.   Фиг. 5. Структура на източника на множествени заявки  ИЗВОДИ  Представеният  в доклада източник на множествени заявки може да се използва за цялостно изследване на конкретни реализации на Time Protocol (RFC-868) сървъри.  Интерес  например  представлява  сравнението  на  обслужването  при  еднозадачна  и многозадачна реализация на сървъра. При множествен пакет с обем 𝑛 = 50 и зададено време на  обслужване  𝐷𝑒𝑙𝑎𝑦𝑇𝑜𝐹𝑟𝑒𝑒 = 1000⁡𝑚𝑠  за  еднозадачната  реализация  се  получава   - 143 - PROCEEDINGS OF UNIVERSITY OF RUSE - 2018, volume 57, book 3.4. производителност  𝑃′ = 𝑛−𝑛𝐸𝑅𝑅 = 50−23 = 0,98 ≈ 1⁡заявка/𝑠,  а  за  многозадачната 𝑡𝐸𝑁𝐷−𝑡𝑆𝑌𝑁 27,684реализация - 𝑃′′ = 𝑛−𝑛𝐸𝑅𝑅 = 50 = 28,92 ≈ 29⁡заявки/𝑠. 𝑡𝐸𝑁𝐷−𝑡𝑆𝑌𝑁 1,729Друга възможност е снемането на зависимостта 𝑃(𝑛) между производителността на многозадачната реализация на сървъра и обема на заявките в пакета. При еднозадачната реализация може да се снеме зависимостта 𝑛 (𝑛) между броя на отхвърлените от сървъра 𝐸𝑅𝑅заявки и обема на пакета.  